<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>pendule_pi: Writing a Python client</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">pendule_pi
   &#160;<span id="projectnumber">1.0.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('pyclient.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Writing a Python client </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md17">Introduction</a></li>
<li class="level1"><a href="#autotoc_md18">Complete Code</a></li>
<li class="level1"><a href="#autotoc_md19">Detailed Explanation</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="autotoc_md17"></a>
Introduction</h1>
<p>This tutorial shows how to establish a connection with the low-level interface using the class <code>PenduleCpp</code>. The C++ client application will move the pendulum back and forth repeatedly, until CTRL-C is pressed to interrupt execution.</p>
<h1><a class="anchor" id="autotoc_md18"></a>
Complete Code</h1>
<p>The code for this tutorial is available in <code>examples/simple_connection/simple_connection.py</code>.</p>
<div class="fragment"><div class="line"><span class="comment">#!/usr/bin/env python3</span></div>
<div class="line"><span class="keyword">import</span> pendule_pi</div>
<div class="line"><span class="keyword">import</span> time</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> __name__ == <span class="stringliteral">&#39;__main__&#39;</span>:</div>
<div class="line">  pendulum = pendule_pi.PendulePy(wait=5)</div>
<div class="line"> </div>
<div class="line">  pwm = 25</div>
<div class="line">  switch_pos = 0.2</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">try</span>:</div>
<div class="line">    <span class="keywordflow">while</span> <span class="keyword">True</span>:</div>
<div class="line">      pendulum.readState(blocking=<span class="keyword">True</span>)</div>
<div class="line">      <span class="keywordflow">if</span> (pendulum.position &gt; switch_pos <span class="keywordflow">and</span> pwm &gt; 0) <span class="keywordflow">or</span> (pendulum.position &lt; -switch_pos <span class="keywordflow">and</span> pwm &lt; 0):</div>
<div class="line">        pwm *= -1</div>
<div class="line">      pendulum.sendCommand(pwm)</div>
<div class="line">  <span class="keywordflow">except</span> KeyboardInterrupt:</div>
<div class="line">    pendulum.sendCommand(0)</div>
<div class="line">    time.sleep(1)</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md19"></a>
Detailed Explanation</h1>
<p></p>
<p>The program starts by importing the relevant modules:</p>
<div class="fragment"><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="keyword">import</span> pendule_pi</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="keyword">import</span> time</div>
</div><!-- fragment --><p>In particular, the first one provides the class <code>PendulePy</code> that allows one to connect to the low-level interface via sockets. An instance of this class is created in the "main":</p>
<div class="fragment"><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;  pendulum = pendule_pi.PendulePy(wait=5)</div>
</div><!-- fragment --><p>Upon construction, the object will connect to the low level interface using default addresses (see <code>PendulePy</code>). You will see in a future tutorial how to change these default settings. Note that we pass a single integer parameter to the constructor. This represents the maximum amount of time to wait for the low-level interface to show up. If no messages are received within this amount of time, an exception will be thrown. You can pass a negative value (the default value is <code>-1</code>) in which case the <code>PendulePy</code> constructor will wait indefinitely for the low-level interface to show up.</p>
<p>We proceed by declaring two variables:</p>
<div class="fragment"><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;  pwm = 25</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;  switch_pos = 0.2</div>
</div><!-- fragment --><p>The first one represents the intensity of the PWM command that we will send to the low-level interface (only its sign will be changed), while the second one corresponds to the distance from the center at which we want to invert the direction of the base.</p>
<p>We then enter a try-catch statement (needed to handle CTRL-C keyboard presses) and then the main loop, which is a <code>while</code> block that keeps running indefinitely. The code inside the loop is quite simple. We begin with the instruction</p>
<div class="fragment"><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;      pendulum.readState(blocking=<span class="keyword">True</span>)</div>
</div><!-- fragment --><p>which attempts to read a message sent from the low-level interface to update a couple of internal variables that store the current state of the pendulum. Since we pass <code>blocking=True</code> as parameter, the function will block execution until the message is received. If <code>blocking=False</code> was passed instead, the function would have firstly checked if a message was available and immediately returned <code>False</code> if no information was ready.</p>
<p>After the state has been updated, we can evaluate the "control":</p>
<div class="fragment"><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;      <span class="keywordflow">if</span> (pendulum.position &gt; switch_pos <span class="keywordflow">and</span> pwm &gt; 0) <span class="keywordflow">or</span> (pendulum.position &lt; -switch_pos <span class="keywordflow">and</span> pwm &lt; 0):</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;        pwm *= -1</div>
</div><!-- fragment --><p>The logic is really simple: if the pendulum is more than <code>switch_pos</code> meters to the right, and the current PWM command is positive (which pushes the base to the right) then we want to invert the command so that now the base moves leftwards. Similarly, if the base is more than <code>switch_pos</code> meters to the left and currently moving leftwards, then change the sign of <code>pwm</code> to invert the motion of the actuator.</p>
<p>Once the command has been evaluated, we just need to send it to the hardware interface:</p>
<div class="fragment"><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;      pendulum.sendCommand(pwm)</div>
</div><!-- fragment --><p>After the while loop, we conclude the program by adding a catch block that intercepts <code>KeyboardInterrupt</code> exceptions (fired when you press CTRL-C). The block sends a null PWM to the low-level interface to stop the motion and sleeps for one second (just to make sure that the socket connection is not closed before the message is sent):</p>
<div class="fragment"><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;  <span class="keywordflow">except</span> KeyboardInterrupt:</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;    pendulum.sendCommand(0)</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;    time.sleep(1)</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="Tutorials.html">Tutorials</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
